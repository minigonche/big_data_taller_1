<!doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8">

        <meta name="description" content="">
        <meta name="author" content="">

        <title>Taller 2</title>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">


    </head>

    <body>
        <div class="container">
            <div class="py-5 text-center">
                {% load static %}
                <img class="d-block mx-auto mb-4" src="{% static "app2/img/header.png" %}" alt="" width="1000" height="342">
                <h1>Taller 2</h1>
                <p class="lead"></p>
            </div>
        </div>


        <!-- ANALISIS HISTORICO -->
        <div class="container">
            <div class="text-left">
                <h2>Análisis Histórico</h2>
            </div>

            <div class="py-2">
                <p class="lead"> POR IMPLEMENTAR </p>
            </div>

        </div>

        <div class="container">
            <div class="py-1">
                <canvas id="network" width="500" height="500 "></canvas>
                <script src="https://d3js.org/d3.v4.min.js"></script>

                <script>

                    /* global d3 */

                    // var graph = {
                    //     nodes: [
                    //         {name: 'John', age: 36},
                    //         {name: 'Andre', age: 25},
                    //         {name: 'Ernie', age: 27},
                    //         {name: 'Harold', age: 28},
                    //         {name: 'Jime', age: 22},
                    //         {name: 'Maria', age: 58}
                    //
                    //     ],
                    //     links: [
                    //         {source: 'John', target: 'Harold'},
                    //         {source: 'John', target: 'Jime'},
                    //         {source: 'Andre', target: 'Ernie'},
                    //         {source: 'Andre', target: 'Maria'},
                    //         {source: 'John', target: 'Maria'},
                    //         {source: 'Jime', target: 'Maria'},
                    //         {source: 'Ernie', target: 'John'},
                    //         {source: 'Andre', target: 'John'},
                    //
                    //     ]
                    // };

                    <!--This creates a canvas -->
                    var canvas = d3.select('#network'),
                        width = canvas.attr('width'),
                        height = canvas.attr('height'),
                        r = 10,
                        ctx = canvas.node().getContext('2d'),
                        simulation = d3.forceSimulation()
                            .force('x', d3.forceX(width/2))
                            .force('y', d3.forceY(height/2))
                            .force('collide', d3.forceCollide(r + 3))
                            .force('charge', d3.forceManyBody()
                                .strength(-200))
                            .force('link', d3.forceLink()
                                .id(function (d) { return d.user_id; }));

                    d3.json('{% static "app2/local_jsons/Historico/users.json" %}', function (err, graph) {
                        if(err) throw err;


                        simulation
                            .nodes(graph.nodes)
                            .on('tick', update)
                            .force('link')
                                .links(graph.links);

                        function update() {
                            ctx.clearRect(0, 0, width, height);
                            ctx.beginPath();                <!-- 'pencil down' -->
                            graph.links.forEach(drawLink);  <!-- call draw function -->
                            ctx.stroke();
                            ctx.beginPath();                <!-- 'pencil down' -->
                            graph.nodes.forEach(drawNode);  <!-- call draw function -->
                            ctx.fill();                     <!-- 'print' -->
                        }

                    });


                    <!-- This actually draws the canvas -->



                    <!-- variables x and y are automatically controlled by simulation system -->
                    function drawNode(d) {
                        ctx.moveTo(d.x, d.y);       <!-- Iterates over the nodes in graph -->
                        ctx.arc(d.x, d.y, r, 0, 2 * Math.PI);   <!-- draws a circle -->
                    }

                    function drawLink(l) {
                        ctx.moveTo(l.source.x, l.source.y);      <!-- Iterates over the source nodes in graph -->
                        ctx.lineTo(l.target.x, l.target.y);       <!-- draws a line -->

                    }

                </script>

            </div>
        </div>



        <!-- BOTON VOLVER -->
        <div class="container">
            <div class="row">
                <div class="col-4"></div>
                    <div class="col-4 text-center">
                        <button type="button" class="btn btn-primary" onclick="location.href='{% url 'app2:index' %}'" > Volver</button>
                    </div>
                <div class="col-4"></div>
            </div>
        </div>






    </body>
</html>
