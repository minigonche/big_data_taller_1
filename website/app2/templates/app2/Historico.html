<!doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8">

        <meta name="description" content="">
        <meta name="author" content="">

        <title>Taller 2</title>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">


    </head>

    <body>
        <div class="container">
            <div class="py-5 text-center">
                {% load static %}
                <img class="d-block mx-auto mb-4" src="{% static "app2/img/header.png" %}" alt="" width="1000" height="342">
                <h1>Taller 2</h1>
                <p class="lead"></p>
            </div>
        </div>


        <!-- ANALISIS HISTORICO -->
        <div class="container">
            <div class="text-left">
                <h2>Análisis Histórico</h2>
            </div>

            <div class="py-2">
                <p class="lead"> POR IMPLEMENTAR </p>
            </div>

        </div>

        <div class="container">
            <div class="py-1">
                <canvas id="network" width="1000" height="1000 "></canvas>
                <script src="https://d3js.org/d3.v4.min.js"></script>

                <script>

                    /* global d3 */


                    <!--This creates a canvas -->
                    var canvas = d3.select('#network'),
                        width = canvas.attr('width'),
                        height = canvas.attr('height'),
                        r = 3,
                        ctx = canvas.node().getContext('2d'),
                        simulation = d3.forceSimulation()
                            .force('x', d3.forceX(width/2))
                            .force('y', d3.forceY(height/2))
                            .force('collide', d3.forceCollide(r + 5 ))
                            // .force('charge', d3.forceManyBody()
                            //     .strength(-5))
                            .force('link', d3.forceLink()
                                .id(function (d) { return d.user_id; }));

                    d3.json('{% static "app2/jsons/Historico/users_test.json" %}', function (err, graph) {
                        if(err) throw err;


                        simulation
                            .nodes(graph.nodes)
                            .on('tick', update)
                            .force('link')
                                .links(graph.links);

                        function update() {
                            ctx.clearRect(0, 0, width, height);
                            ctx.beginPath();                <!-- 'pencil down' -->
                            ctx.globalAlpha = 0.5;          <!-- 'opacity' -->
                            ctx.strokeStyle = "#aaa";
                            graph.links.forEach(drawLink);  <!-- call draw function -->
                            ctx.stroke();


                                           <!-- 'pencil down' -->
                            ctx.globalAlpha = 1.0;
                            graph.nodes.forEach(drawNode);  <!-- call draw function -->
                                                 <!-- 'print' -->
                        }

                    });


                    function selectColor(d) {
                        if(d.classification < 0){
                            return '#4FB99F';
                        } else if(d.classification > 0) {
                            return '#068587';
                        } else {return '#ED553B'}
                    }

                    <!-- variables x and y are automatically controlled by simulation system -->
                    function drawNode(d) {

                        ctx.beginPath();
                        ctx.fillStyle = selectColor(d) ;
                        ctx.moveTo(d.x, d.y);       <!-- Iterates over the nodes in graph -->
                        ctx.arc(d.x, d.y, r, 0, 2 * Math.PI);   <!-- draws a circle -->
                        ctx.fill();
                    }

                    function drawLink(l) {
                        ctx.moveTo(l.source.x, l.source.y);      <!-- Iterates over the source nodes in graph -->
                        ctx.lineTo(l.target.x, l.target.y);       <!-- draws a line -->

                    }

                </script>

            </div>
        </div>



        <!-- BOTON VOLVER -->
        <div class="container">
            <div class="row">
                <div class="col-4"></div>
                    <div class="col-4 text-center">
                        <button type="button" class="btn btn-primary" onclick="location.href='{% url 'app2:index' %}'" > Volver</button>
                    </div>
                <div class="col-4"></div>
            </div>
        </div>






    </body>
</html>
